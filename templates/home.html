{% extends 'base.html' %}

{% block content %}

<header>Select Victim</header>
<p>Enter the LinkedIn username or profile url of the person you want to target. PhishGpt will load the publicly available information to generate a targeted phishing email.</p>


<form class="form__group field" id="form">
    <input type="input" class="form__field" placeholder="https://www.linkedin.com/in/victim" name="input-text" id='input-text' required />
    <label for="input-text" class="form__label">LinkedIn Url</label>
</form>

<div class="mainBtnContainer">
    <button type="submit" id="submit-button" class="mainBtn" disabled>
        Phish!
    </button>
</div>

<div id="result-container" class="results">
    <div>
Dear Bill Gates,

My name is Samuel, and I can’t begin to express how much I admire and respect the work you’ve done. Your professional journey - from attending Lakeside School and Harvard University, to your founding Microsoft and Breakthrough Energy, to your charity work at the Bill & Melinda Gates Foundation — is absolutely inspiring.

I’m currently working on a project related to global resource management, and I heard about your interest in these areas through your active blogging. I believe you could provide valuable insight into the matter, so I kindly ask for the opportunity to discuss it with you further. 

I’ve created a short survey [INSERT LINK HERE] that might help you better understand the project and its goals. If you have the time and interest, I’m sure your contributions will be of great help to this project.

Thank you for your time and I look forward to hearing from you.

Sincerely, 

Samuel
    </div>
</div>


<script>
    const form = document.querySelector('#form');
    const submitButton = document.querySelector('#submit-button');
    const resultContainer = document.querySelector("#result-container");
    const formField = document.querySelector('#input-text');

    function displayLoading() {
        console.log("Display loading called");
        submitButton.disabled=true;
        submitButton.innerHTML="<i class='fa fa-spinner fa-spin'></i> This will take up to 30 seconds";
        setTimeout(() => {
            submitButton.disabled=false;
            submitButton.innerHTML="Phish!";
        }, 40000);

    }

    function hideLoading() {
        submitButton.disabled=false;
        document.getElementById("submit-button").innerHTML="Phish!";
    }

    formField.addEventListener('input', function() {
        console.log("In event listener for input field");
        if (formField.value.trim() === '') {
            submitButton.disabled = true;
        } else {
            submitButton.disabled = false;
        }
    });
    
    submitButton.addEventListener('click', function(event) {
        console.log("Let's start");
        displayLoading();
  
        const data = new FormData(form);

        fetch('/send', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(Object.fromEntries(data))
            })
            .then(response => response.json())
            .then(data => {
                hideLoading();
                console.log('Form submitted successfully!');
                console.log(data); // This will log the response data as a JavaScript object
                // You can do something with the data object here
                const newElement = document.createElement("pre");
                newElement.innerText = data['mail_text'];
                resultContainer.appendChild(newElement);
            })
            .catch(error => {
            // handle any network errors
            alert('Error: ' + error);
        });


    });
  </script>

{% endblock %}